const axios = require("axios");
const cheerio = require("cheerio");
const fs = require("fs");

// URL of the page we want to scrape
const linkToPhrasesSample = "https://basicenglishspeaking.com/100-common-phrases-and-sentence-patterns/";

export default async (req, res) => {
  try {
    const a = [
      "https://basicenglishspeaking.com/001-are-you-sure/",
      "https://basicenglishspeaking.com/002-are-you-used-to/",
      "https://basicenglishspeaking.com/003-as-far-as/",
      "https://basicenglishspeaking.com/004-as-far-as-is-am-are-concerned/",
      "https://basicenglishspeaking.com/006-but-this-doesnt-mean-that/",
      "https://basicenglishspeaking.com/005-be-careful-with/",
      "https://basicenglishspeaking.com/008-compared-to/",
      "https://basicenglishspeaking.com/007-by-the-way/",
      "https://basicenglishspeaking.com/010-dont-ever/",
      "https://basicenglishspeaking.com/011-do-you-agree/",
      "https://basicenglishspeaking.com/012-do-you-carry-this-in/",
      "https://basicenglishspeaking.com/013-do-you-have-available/",
      "https://basicenglishspeaking.com/009-did-you-use-to/",
      "https://basicenglishspeaking.com/015-do-you-feel-like/",
      "https://basicenglishspeaking.com/014-do-you-mind/",
      "https://basicenglishspeaking.com/016-shouldnt-we/",
      "https://basicenglishspeaking.com/017-have-you-ever/",
      "https://basicenglishspeaking.com/020-he-is-either-or/",
      "https://basicenglishspeaking.com/018-not-until/",
      "https://basicenglishspeaking.com/019-he-is-as-as/",
      "https://basicenglishspeaking.com/022-he-is-not-only-but-also/",
      "https://basicenglishspeaking.com/023-help-yourself-to/",
      "https://basicenglishspeaking.com/021-he-is-so-that/",
      "https://basicenglishspeaking.com/024-how-about/",
      "https://basicenglishspeaking.com/025-how-come/",
      "https://basicenglishspeaking.com/026-how-dare-you/",
      "https://basicenglishspeaking.com/029-how-often/",
      "https://basicenglishspeaking.com/027-how-do-you-like/",
      "https://basicenglishspeaking.com/028-how-long-does-it-take/",
      "https://basicenglishspeaking.com/031-i-can-hardly-believe-that/",
      "https://basicenglishspeaking.com/032-i-cant-help/",
      "https://basicenglishspeaking.com/030-i-bet/",
      "https://basicenglishspeaking.com/033-i-cant-say/",
      "https://basicenglishspeaking.com/034-i-cannot-wait-to/",
      "https://basicenglishspeaking.com/037-id-hate-for-you-to/",
      "https://basicenglishspeaking.com/036-id-like-you-to/",
      "https://basicenglishspeaking.com/039-if-there-is-one-thing-that-me-its/",
      "https://basicenglishspeaking.com/038-if-it-hadnt-been-for/",
      "https://basicenglishspeaking.com/035-i-dare-say/",
      "https://basicenglishspeaking.com/041-i-have-got-to/",
      "https://basicenglishspeaking.com/042-as-as-possible/",
      "https://basicenglishspeaking.com/044-id-be-grateful/",
      "https://basicenglishspeaking.com/043-ill-let-you-know/",
      "https://basicenglishspeaking.com/040-i-have-no-idea/",
      "https://basicenglishspeaking.com/047-im-looking-forward-to/",
      "https://basicenglishspeaking.com/045-im-afraid/",
      "https://basicenglishspeaking.com/046-im-calling-to/",
      "https://basicenglishspeaking.com/048-im-not-really-happy-with/",
      "https://basicenglishspeaking.com/051-it-is-that/",
      "https://basicenglishspeaking.com/050-i-really-go-for/",
      "https://basicenglishspeaking.com/052-its-too-bad-that/",
      "https://basicenglishspeaking.com/049-im-thinking-about/",
      "https://basicenglishspeaking.com/053-its-my-fault-for/",
      "https://basicenglishspeaking.com/055-its-on-the-tip-of-my-tongue/",
      "https://basicenglishspeaking.com/057-its-up-to/",
      "https://basicenglishspeaking.com/056-its-said-that/",
      "https://basicenglishspeaking.com/058-its-your-turn/",
      "https://basicenglishspeaking.com/059-it-may-surprise-you-but/",
      "https://basicenglishspeaking.com/054-its-not-that-but/",
      "https://basicenglishspeaking.com/061-ive-had-enough-of/",
      "https://basicenglishspeaking.com/062-i-wonder-if-%ef%bc%9f/",
      "https://basicenglishspeaking.com/060-i-have-been/",
      "https://basicenglishspeaking.com/064-no-matter-what/",
      "https://basicenglishspeaking.com/063-i-would-rather-than/",
      "https://basicenglishspeaking.com/066-now-that-i-come-to-think-about-it/",
      "https://basicenglishspeaking.com/065-no-wonder/",
      "https://basicenglishspeaking.com/068-only-to-find/",
      "https://basicenglishspeaking.com/069-on-one-hand-on-the-other-hand/",
      "https://basicenglishspeaking.com/067-once-you/",
      "https://basicenglishspeaking.com/071-speaking-of/",
      "https://basicenglishspeaking.com/070-see-that/",
      "https://basicenglishspeaking.com/072-thanks-to/",
      "https://basicenglishspeaking.com/075-the-more-the-more/",
      "https://basicenglishspeaking.com/074-the-first-thing-im-going-to-do-when-is/",
      "https://basicenglishspeaking.com/076-there-is-nothing-as-as/",
      "https://basicenglishspeaking.com/077-there-is-nothing-i-like-better-than/",
      "https://basicenglishspeaking.com/078-wed-be-better-off-without/",
      "https://basicenglishspeaking.com/073-thank-you-for/",
      "https://basicenglishspeaking.com/079-wed-better/",
      "https://basicenglishspeaking.com/081-what-becomes-of-%ef%bc%9f/",
      "https://basicenglishspeaking.com/080-we-may-as-well/",
      "https://basicenglishspeaking.com/082-what-can-i-do-for-%ef%bc%9f/",
      "https://basicenglishspeaking.com/084-what-do-you-call-it-what%c2%b7cha%c2%b7ma%c2%b7call%c2%b7it/",
      "https://basicenglishspeaking.com/085-what-do-you-say/",
      "https://basicenglishspeaking.com/083-what-do-you-mean-by/",
      "https://basicenglishspeaking.com/087-what-if/",
      "https://basicenglishspeaking.com/086-what-for/",
      "https://basicenglishspeaking.com/088-what-im-trying-to-say-is/",
      "https://basicenglishspeaking.com/090-what-would-you-do-if/",
      "https://basicenglishspeaking.com/089-whats-the-matter-with/",
      "https://basicenglishspeaking.com/093-where-can-i/",
      "https://basicenglishspeaking.com/091-whats-the-use-of/",
      "https://basicenglishspeaking.com/094-where-there-is-there-is/",
      "https://basicenglishspeaking.com/092-whats-your-favorite/",
      "https://basicenglishspeaking.com/096-why-not/",
      "https://basicenglishspeaking.com/097-would-you-care-for/",
      "https://basicenglishspeaking.com/100-you-only-have-to-in-order-to/",
      "https://basicenglishspeaking.com/098-you-are-not-to/",
      "https://basicenglishspeaking.com/099-you-can-never-too/",
      "https://basicenglishspeaking.com/095-whether-or-not/",
      "https://basicenglishspeaking.com/001-are-you-sure/",
      "https://basicenglishspeaking.com/002-are-you-used-to/",
      "https://basicenglishspeaking.com/003-as-far-as/",
      "https://basicenglishspeaking.com/005-be-careful-with/",
      "https://basicenglishspeaking.com/004-as-far-as-is-am-are-concerned/",
      "https://basicenglishspeaking.com/007-by-the-way/",
      "https://basicenglishspeaking.com/006-but-this-doesnt-mean-that/",
      "https://basicenglishspeaking.com/009-did-you-use-to/",
      "https://basicenglishspeaking.com/010-dont-ever/",
      "https://basicenglishspeaking.com/008-compared-to/",
      "https://basicenglishspeaking.com/012-do-you-carry-this-in/",
      "https://basicenglishspeaking.com/013-do-you-have-available/",
      "https://basicenglishspeaking.com/011-do-you-agree/",
      "https://basicenglishspeaking.com/015-do-you-feel-like/",
      "https://basicenglishspeaking.com/017-have-you-ever/",
      "https://basicenglishspeaking.com/018-not-until/",
      "https://basicenglishspeaking.com/016-shouldnt-we/",
      "https://basicenglishspeaking.com/020-he-is-either-or/",
      "https://basicenglishspeaking.com/019-he-is-as-as/",
      "https://basicenglishspeaking.com/021-he-is-so-that/",
      "https://basicenglishspeaking.com/023-help-yourself-to/",
      "https://basicenglishspeaking.com/022-he-is-not-only-but-also/",
      "https://basicenglishspeaking.com/014-do-you-mind/",
      "https://basicenglishspeaking.com/024-how-about/",
      "https://basicenglishspeaking.com/026-how-dare-you/",
      "https://basicenglishspeaking.com/027-how-do-you-like/",
      "https://basicenglishspeaking.com/029-how-often/",
      "https://basicenglishspeaking.com/028-how-long-does-it-take/",
      "https://basicenglishspeaking.com/031-i-can-hardly-believe-that/",
      "https://basicenglishspeaking.com/025-how-come/",
      "https://basicenglishspeaking.com/033-i-cant-say/",
      "https://basicenglishspeaking.com/032-i-cant-help/",
      "https://basicenglishspeaking.com/034-i-cannot-wait-to/",
      "https://basicenglishspeaking.com/036-id-like-you-to/",
      "https://basicenglishspeaking.com/030-i-bet/",
      "https://basicenglishspeaking.com/035-i-dare-say/",
      "https://basicenglishspeaking.com/038-if-it-hadnt-been-for/",
      "https://basicenglishspeaking.com/039-if-there-is-one-thing-that-me-its/",
      "https://basicenglishspeaking.com/040-i-have-no-idea/",
      "https://basicenglishspeaking.com/037-id-hate-for-you-to/",
      "https://basicenglishspeaking.com/042-as-as-possible/",
      "https://basicenglishspeaking.com/043-ill-let-you-know/",
      "https://basicenglishspeaking.com/044-id-be-grateful/",
      "https://basicenglishspeaking.com/046-im-calling-to/",
      "https://basicenglishspeaking.com/047-im-looking-forward-to/",
      "https://basicenglishspeaking.com/041-i-have-got-to/",
      "https://basicenglishspeaking.com/048-im-not-really-happy-with/",
      "https://basicenglishspeaking.com/049-im-thinking-about/",
      "https://basicenglishspeaking.com/051-it-is-that/",
      "https://basicenglishspeaking.com/050-i-really-go-for/",
      "https://basicenglishspeaking.com/045-im-afraid/",
      "https://basicenglishspeaking.com/052-its-too-bad-that/",
      "https://basicenglishspeaking.com/053-its-my-fault-for/",
      "https://basicenglishspeaking.com/055-its-on-the-tip-of-my-tongue/",
      "https://basicenglishspeaking.com/054-its-not-that-but/",
      "https://basicenglishspeaking.com/059-it-may-surprise-you-but/",
      "https://basicenglishspeaking.com/057-its-up-to/",
      "https://basicenglishspeaking.com/058-its-your-turn/",
      "https://basicenglishspeaking.com/061-ive-had-enough-of/",
      "https://basicenglishspeaking.com/056-its-said-that/",
      "https://basicenglishspeaking.com/062-i-wonder-if-%ef%bc%9f/",
      "https://basicenglishspeaking.com/064-no-matter-what/",
      "https://basicenglishspeaking.com/063-i-would-rather-than/",
      "https://basicenglishspeaking.com/067-once-you/",
      "https://basicenglishspeaking.com/065-no-wonder/",
      "https://basicenglishspeaking.com/060-i-have-been/",
      "https://basicenglishspeaking.com/068-only-to-find/",
      "https://basicenglishspeaking.com/069-on-one-hand-on-the-other-hand/",
      "https://basicenglishspeaking.com/070-see-that/",
      "https://basicenglishspeaking.com/066-now-that-i-come-to-think-about-it/",
      "https://basicenglishspeaking.com/071-speaking-of/",
      "https://basicenglishspeaking.com/073-thank-you-for/",
      "https://basicenglishspeaking.com/074-the-first-thing-im-going-to-do-when-is/",
      "https://basicenglishspeaking.com/076-there-is-nothing-as-as/",
      "https://basicenglishspeaking.com/072-thanks-to/",
      "https://basicenglishspeaking.com/075-the-more-the-more/",
      "https://basicenglishspeaking.com/077-there-is-nothing-i-like-better-than/",
      "https://basicenglishspeaking.com/080-we-may-as-well/",
      "https://basicenglishspeaking.com/078-wed-be-better-off-without/",
      "https://basicenglishspeaking.com/082-what-can-i-do-for-%ef%bc%9f/",
      "https://basicenglishspeaking.com/081-what-becomes-of-%ef%bc%9f/",
      "https://basicenglishspeaking.com/079-wed-better/",
      "https://basicenglishspeaking.com/083-what-do-you-mean-by/",
      "https://basicenglishspeaking.com/084-what-do-you-call-it-what%c2%b7cha%c2%b7ma%c2%b7call%c2%b7it/",
      "https://basicenglishspeaking.com/086-what-for/",
      "https://basicenglishspeaking.com/085-what-do-you-say/",
      "https://basicenglishspeaking.com/088-what-im-trying-to-say-is/",
      "https://basicenglishspeaking.com/089-whats-the-matter-with/",
      "https://basicenglishspeaking.com/087-what-if/",
      "https://basicenglishspeaking.com/090-what-would-you-do-if/",
      "https://basicenglishspeaking.com/093-where-can-i/",
      "https://basicenglishspeaking.com/092-whats-your-favorite/",
      "https://basicenglishspeaking.com/094-where-there-is-there-is/",
      "https://basicenglishspeaking.com/095-whether-or-not/",
      "https://basicenglishspeaking.com/091-whats-the-use-of/",
      "https://basicenglishspeaking.com/097-would-you-care-for/",
      "https://basicenglishspeaking.com/096-why-not/",
      "https://basicenglishspeaking.com/098-you-are-not-to/",
      "https://basicenglishspeaking.com/099-you-can-never-too/",
      "https://basicenglishspeaking.com/100-you-only-have-to-in-order-to/",
    ];

    const v = a.split("*****").map((x) => `'${x}'`);

    fs.writeFile("phraseLink.js", `export default  [${v}]`, (err) => console.log(err));

    res.status(200).json("sds");
    return;
    // Fetch HTML of the page we want to scrape
    const { data } = await axios.get(linkToPhrasesSample);
    // Load HTML we fetched in the previous line
    const $ = cheerio.load(data);

    // Select all the list items in plainlist class
    const listItems = $("tr td");

    // get link to full sample
    // Stores data for all linkToExamples
    // const commonEnglishLink = listItems.map((idx, el) => $(el).children("a").attr("href"));

    const commonEnglishLink = [];

    listItems.each((idx, el) => {
      const a = $(el).children("a").attr("href");
      // commonEnglishLink.push(a);

      fs.appendFile("phraseLink.txt", `*****${a}`, function (err) {
        if (err) {
          // append failed
          console.log("failed");
        } else {
          console.log(a);
          // done
        }
      });
    });

    // console.log(commonEnglishLink);

    const phraseExamples = [];

    for (const exampleLink of commonEnglishLink) {
      // for (const exampleLink of [commonEnglishLink[0]]) {
      // Fetch HTML of the page we want to scrape
      const { data } = await axios.get(exampleLink);
      // Load HTML we fetched in the previous line
      const $ = cheerio.load(data);
      // console.log({ exampleLink });

      // get text in doc
      const listItems = $("section article div").text();

      // get text after I. EXAMPLES: and before II. DIALOGUES:
      const text = listItems.split("I. EXAMPLES:")[1].split("II. DIALOGUES:")[0];

      // const listItems = $("section article div");
      // const c = $(".sc_player_container1").siblings()[0].tagName;
      // const listItemsw = $(':contains("Are you sure")').toArray()[0];

      //loop through phrases and push phrases to list of phrases
      const phraseExample = text
        .trim()
        .split(/\n/)
        .map((phrase) =>
          phrase
            .replace(/&nbsp;/g, " ") // replace &nbsp; with emptyspace
            .replace(/  +/g, " ") //remove multiple multispace
            .trim()
        );

      for (const phrase of phraseExample) {
        // for (const phrase of [phraseExample[0]]) {
        // const translateUrl = `https://translate.google.com/?sl=en&tl=es&text=${encodeURIComponent(phrase)}&op=translate`;

        // // Fetch HTML of the page we want to scrape
        // const { data } = await axios.get(translateUrl);

        // // phraseExamples

        // phraseExamples.push(phrase);
        fs.appendFile("phrase.txt", `*****${phrase}`, function (err) {
          if (err) {
            // append failed
            console.log("failed");
          } else {
            console.log(phrase);
            // done
          }
        });

        // // Load HTML we fetched in the previous line
        // const $ = cheerio.load(data);

        // // Select all the list items in plainlist class
        // const listItems = $(".plainlist ul li");
        // // Stores data for all countries
        // const countries = [];
        // // Use .each method to loop through the li we selected
        // listItems.each((idx, el) => {
        //   // Object holding data for each country/jurisdiction
        //   const country = { name: "", iso3: "" };
        //   // Select the text content of a and span elements
        //   // Store the textcontent in the above object
        //   country.name = $(el).children("a").text();
        //   country.iso3 = $(el).children("span").text();
        //   // Populate countries array with country data
        //   countries.push(country);
        // });

        // Select all the list items in plainlist class

        // const listItems = $("span");
        // const listItems = $(".VIiyi").data();

        // console.log(translateUrl, listItems);

        // listItems.each((i, elem) => {
        //   //   // const a = $(el).children("span").text();
        // const a = $(elem).children("").text();
        //   //   // const a = $(el).text();
        // console.log($(elem).text());
        // console.log($(elem).text());
        // console.log(a);
        // });
      }

      // const a = $(".sc_player_container1").nextAll().nextUntil("strong");

      // const title = $.html($("h1 .entry-title"));
      // const title = $.contains("You only have");
      // const title = $.text($("h1 .entry-title"));

      // const title = $('.sc_player_container1:contains("are-you-sure")').next().text();

      // console.log(exampleLink, title);

      // <h1 class="entry-title">100. You only have to…in order to…</h1>;
      // const listItems = $("section article div");
      // const listItems = $("section article div");

      // listItems.each((idx, el) => {
      //   // console.log(a);
      //   const a = $(el).text();

      //   //   // const a = $(el).children("span").text();
      //   //   // const a = $(el).children("").text();
      //   //   // const a = $(el).text();
      //   //   // const a = $(el).text();
      //   //   // <div class="sc_player_container1"><input type="button" id="btnplay_6263bfe6bb2bf5.11283273" class="myButton_play" onclick="play_mp3('play','6263bfe6bb2bf5.11283273','http://basicenglishspeaking.com/wp-content/uploads/2016/audio/100/100-01.mp3','80','false');show_hide('play','6263bfe6bb2bf5.11283273');"><input type="button" id="btnstop_6263bfe6bb2bf5.11283273" style="display:none" class="myButton_stop" onclick="play_mp3('stop','6263bfe6bb2bf5.11283273','','80','false');show_hide('stop','6263bfe6bb2bf5.11283273');"><div id="sm2-container"><!-- flash movie ends up here --></div></div>
      //   //   // commonEnglishLink.push(a);
      // });
    }

    // console.log(phraseExamples);

    // replace &nbsp;

    // const commonEnglishLink = listItems.map((idx, el) => $(el).children("a").attr("href"))

    //   const linkToExamples = listItems.map((idx, el) => {
    //   // Object holding data for each country/jurisdiction
    //   // const country = { name: "", iso3: "" };
    //   // // Select the text content of a and span elements
    //   // // Store the textcontent in the above object
    //   const link = $(el).children("a").attr("href");
    //   // country.iso3 = $(el).children("span").text();
    //   // // Populate countries array with country data

    //   // countries.push(country);
    // });

    // console.log(phraseExamples);

    // fs.writeFile("/phrases.js", phraseExamples, function (err) {
    //   if (err) {
    //     return console.log(err);
    //   }
    //   console.log("The file was saved!");
    // });

    // var file = fs.createWriteStream(phraseExamples);
    // file.on("error", function (err) {
    //   /* error handling */
    // });
    // arr.forEach(function (v) {
    //   file.write(v.join(", ") + "\n");
    // });
    // file.end();

    // fs.writeFile(
    //   "/phrase.json",

    //   JSON.stringify(phraseExamples),

    //   function (err) {
    //     if (err) {
    //       console.error("Crap happens");
    //     }
    //   }
    // );

    return res.status(200).json("success");
  } catch (error) {
    // log errors only in development
    process.env.NODE_ENV !== "production" && console.log(error);
    return res.status(401).json(false);
  }
};
